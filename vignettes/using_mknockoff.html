<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Guo Yu" />

<meta name="date" content="2020-04-12" />

<title>Using the cheapknockoff package</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using the cheapknockoff package</h1>
<h4 class="author">Guo Yu</h4>
<h4 class="date">2020-04-12</h4>



<p>The <code>cheapknockoff</code> package contains the implementations of a procedure for performing feature selection when features have costs. The basic premise is to construct multiple knockoffs for each feature, forcing the more expensive feature to compete with more knockoffs. This makes the more expensive feature harder to be selected unless it shows significant association with the response given its cost. The details of our proposal can be found in <a href="https://arxiv.org/abs/1910.03627">Yu, Witten, and Bien (2019) <em>Controlling Costs: Feature Selection on a Budget</em></a>.</p>
<div id="data-simulation" class="section level2">
<h2>Data simulation</h2>
<p>We consider the following linear model, <span class="math display">\[
y = \sum_{j = 1}^p X_j \beta^\ast_j + \varepsilon,
\]</span> where <span class="math inline">\(X \sim N(\mathbf{0}, \mathbf{I}_p)\)</span>, and <span class="math inline">\(\varepsilon \sim N(0, 1)\)</span>. The following code simulates <span class="math inline">\(n = 100\)</span> observation from the model above with <span class="math inline">\(p = 30\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(cheapknockoff)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">p &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">rnorm</span>(n <span class="op">*</span><span class="st"> </span>p), <span class="dt">nrow =</span> n, <span class="dt">ncol =</span> p)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">y &lt;-<span class="st"> </span>x[, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x[, <span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)</a></code></pre></div>
<p>Additionally, we consider the setting where these features have costs. For example, we set the costs for the two relevant features <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> as <span class="math inline">\(2\)</span> and <span class="math inline">\(9\)</span>, and the costs for other features are randomly selected integer values between <span class="math inline">\(2\)</span> and <span class="math inline">\(9\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">omega &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">9</span>, <span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">9</span>), <span class="dt">size =</span> <span class="dv">28</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
</div>
<div id="using-cheapknockoff-functions" class="section level2">
<h2>Using <code>cheapknockoff</code> functions</h2>
<p>Performing the cost-conscious feature selection procedure using <code>cheapknockoff</code> package involves the following three steps:</p>
<ol style="list-style-type: decimal">
<li>Construct multiple knockoffs</li>
<li>Compute knockoff statistics</li>
<li>Output the path of selected variables</li>
</ol>
<div id="constructing-multiple-knockoffs" class="section level3">
<h3>Constructing multiple knockoffs</h3>
<p>The function <code>multiple_knockoff_Gaussian</code> constructs multiple knockoffs by assuming that the design matrix follows a multivariate Gaussian distribution with known mean and covariance matrix (which, in this simulation setting, are <span class="math inline">\(\mathbf{0}\)</span> and <span class="math inline">\(\mathbf{I}\)</span> respectively). It also requires the input of feature costs.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">X_k &lt;-<span class="st"> </span><span class="kw">multiple_knockoff_Gaussian</span>(<span class="dt">X =</span> x, <span class="dt">mu =</span> <span class="kw">rep</span>(<span class="dv">0</span>, p), <span class="dt">Sigma =</span> <span class="kw">diag</span>(<span class="dv">1</span>, p), <span class="dt">omega =</span> omega)</a></code></pre></div>
<p>Constructing multiple knockoffs involves solving a optimization problem. There are three formulations of the involved optimization problem, which can be specified as an input in <code>knockoff_Guassian</code>. For details, see <a href="https://arxiv.org/abs/1810.11378">Gimenez &amp; Zhou (2018) <em>Improving the Stability of the Knockoff Procedure: Multiple Simultaneous Knockoffs and Entropy Maximization</em></a>.</p>
</div>
<div id="computing-knockoff-statistics" class="section level3">
<h3>Computing knockoff statistics</h3>
<p>With the constructed multiple knockoffs, the next step is to compute the test statistics used to perform feature selection. In particular, the function <code>stat_glmnet_coef</code> computes the statistics based on the absolute value of the coefficient estimate from <code>glmnet</code> fit. For further details, see Section 2.2 of <a href="https://arxiv.org/abs/1910.03627">Yu, Witten, and Bien (2019) <em>Controlling Costs: Feature Selection on a Budget</em></a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">stat &lt;-<span class="st"> </span>cheapknockoff<span class="op">::</span><span class="kw">stat_glmnet_coef</span>(<span class="dt">X =</span> x, <span class="dt">X_k =</span> X_k, <span class="dt">y =</span> y, <span class="dt">omega =</span> omega)</a></code></pre></div>
<p>The output of <code>stat_glmnet_coef</code> is a list of three components. <code>kappa</code> is the vector of indices of <code>winner</code> for each variable competing with its multiple knockoff counterparts. <code>kappa[j] = 1</code> indicates that the original variable is beating all of its knockoff counterparts, and <code>kappa[j]</code> not equal to <code>1</code> means otherwise. <code>tau</code> is a vector of scores determining the order for which we consider to include variables into the model. Finally, <code>score_total</code> is the original <code>glmnet</code> coefficient estimates for each variable and its knockoff counterparts.</p>
</div>
<div id="building-the-path-of-selected-variables" class="section level3">
<h3>Building the path of selected variables</h3>
<p>Finally, the following function <code>generate_path</code> yields a path of selected variables.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">path &lt;-<span class="st"> </span>cheapknockoff<span class="op">::</span><span class="kw">generate_path</span>(<span class="dt">kappa =</span> stat<span class="op">$</span>kappa, <span class="dt">tau =</span> stat<span class="op">$</span>tau)</a></code></pre></div>
<p>The output <code>path</code> is a list of selected variable sets. For example,</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">path[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p>is <span class="math inline">\(X_1\)</span>. The more relavant feature <span class="math inline">\(X_2\)</span> (in the sense that <span class="math inline">\(X_2\)</span> has larger coefficient) is later included in</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">path[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; [1] 1 2</span></a></code></pre></div>
<p>It is because <span class="math inline">\(X_2\)</span> is much more expensive than <span class="math inline">\(X_1\)</span>. This relects the premise of our proposal on making use of cheap features over expensive features.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
